FROM cypress/base
RUN mkdir -p /opt/justto-web
WORKDIR /opt/justto-web
COPY package.json .
RUN npm install

# Install chrome
RUN echo "deb [trusted=yes] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list
RUN apt-get update --allow-unauthenticated
RUN wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
RUN apt install -y ./google-chrome*.deb
RUN rm -f google-chrome*.deb

# copy spec files and website files
COPY public public
COPY src src
COPY tests tests
COPY .env .env
COPY vue.config.js vue.config.js
COPY styleguide.config.js styleguide.config.js
COPY cypress.json cypress.json

# rerun E2E tests only if any of the previous files change
RUN $(npm bin)/cypress run -b chrome -e BASE_URL=https://homol.justto.com.br
