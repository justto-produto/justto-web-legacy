(self["webpackChunk_projuris_justto_web"]=self["webpackChunk_projuris_justto_web"]||[]).push([[1610],{62452:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});s(57658);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"external-view"},[t("el-container",[t("el-aside",{staticClass:"display-flex",attrs:{width:"40%"}},[e.workspaces.length?t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.showLoading,expression:"showLoading"}],ref:"workspaceForm",staticClass:"external-view__form",attrs:{model:e.workspaceForm,rules:e.workspaceRules,"label-position":"top"},nativeOn:{submit:function(t){return t.preventDefault(),e.selectWorkspace.apply(null,arguments)}}},[t("h1",{staticClass:"external-view__title"},[e._v(" Equipe ")]),t("p",[e._v("Selecione uma de suas equipes de trabalho para entrar.")]),t("el-form-item",{attrs:{label:"Equipe",prop:"selectedWorkspaceIndex"}},[t("el-select",{attrs:{placeholder:"Selecione",filterable:"","data-testid":"select-workspace"},model:{value:e.workspaceForm.selectedWorkspaceIndex,callback:function(t){e.$set(e.workspaceForm,"selectedWorkspaceIndex",t)},expression:"workspaceForm.selectedWorkspaceIndex"}},e._l(e.workspaces,(function(e,s){return t("el-option",{key:s,attrs:{value:s,label:e.workspace.teamName,"data-testid":"select-workspace-item"}})})),1)],1),t("el-button",{staticClass:"external-view__submit",attrs:{"native-type":"submit",type:"primary","data-testid":"submit-workspace"}},[e._v(" Selecionar e entrar ")]),t("br"),t("br"),e.$store.getters.isJusttoAdmin?t("el-button",{staticClass:"external-view__submit",attrs:{type:"secondary",icon:"el-icon-s-operation"},on:{click:function(t){return e.$router.push("admin-panel")}}},[e._v(" Painel administrativo ")]):e._e()],1):t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.showLoading,expression:"showLoading"}],ref:"loginForm",staticClass:"external-view__form",attrs:{"element-loading-text":e.loadingText,model:e.loginForm,rules:e.rules,"label-position":"top"},nativeOn:{submit:function(t){return t.preventDefault(),e.doLogin.apply(null,arguments)}}},[t("h1",{staticClass:"external-view__title center"},[e._v(" Autenticação ")]),t("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.showError,expression:"showError"}],attrs:{title:e.errorMessage,type:"error","data-testid":"login-failure"},on:{close:function(t){e.showError=!1}}}),t("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.showSuccess,expression:"showSuccess"}],attrs:{title:"Cadastro ativado com sucesso!",type:"success","data-testid":"register-success"},on:{close:function(t){e.showSuccess=!1}}}),t("el-form-item",{attrs:{label:"Email",prop:"email"}},[t("el-input",{attrs:{type:"email",name:"login-email","data-testid":"login-email"},model:{value:e.loginForm.email,callback:function(t){e.$set(e.loginForm,"email",t)},expression:"loginForm.email"}})],1),t("el-form-item",{attrs:{label:"Senha",prop:"password"}},[t("el-input",{attrs:{type:e.passwordType,name:"login-password","data-testid":"login-password"},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}}),t("div",{staticClass:"el-button--input-float"},[t("jus-icon",{staticClass:"external-view__show-password",attrs:{icon:e.showPassword?"hide":"eye"},nativeOn:{click:function(t){return e.switchShowPassword.apply(null,arguments)}}}),t("el-button",{attrs:{type:"text",tabindex:"-1","data-testid":"forgot-password"},on:{click:function(t){return e.$router.push("forgot-password")}}},[e._v(" Esqueceu sua senha? ")])],1)],1),t("el-button",{staticClass:"external-view__submit",attrs:{"native-type":"submit",type:"primary","data-testid":"submit-login"}},[e._v(" Entrar ")]),t("el-row",{staticClass:"external-view__info"},[e._v(" Ao clicar em Entrar, eu concordo com os "),t("a",{attrs:{"data-testid":"use-terms",href:"https://justto.com.br/termos-de-uso/",target:"_blank"}},[e._v(" Termos de Uso")]),e._v(", com os "),t("a",{attrs:{"data-testid":"contract-terms",href:"https://justto.com.br/termos-de-contratacao/",target:"_blank"}},[e._v("Termos Gerais de Contratação")]),e._v(" e a "),t("a",{attrs:{"data-testid":"contract-terms",href:"https://justto.com.br/politica-privacidade/",target:"_blank"}},[e._v("Política de Privacidade")]),e._v(". ")])],1)],1),t("el-main",{staticClass:"hidden-sm-and-down"},[t("ProjusrisSidenavExternal")],1)],1)],1)},r=[],a=(s(46229),s(17330),s(62062),s(40917)),i=s(18814),n=s(90408),l={name:"Login",components:{ProjusrisSidenavExternal:()=>s.e(6599).then(s.bind(s,96599))},data(){return{loadingText:"Autenticando...",loadingIndex:0,workspaces:[],showPassword:!1,showError:!1,showSuccess:!1,showLoading:!1,errorMessage:"",loginForm:{email:"",password:""},rules:{email:[{required:!0,message:"Campo obrigatório",trigger:"submit"},{type:"email",required:!0,message:"Insira um e-mail válido",trigger:["submit"]}],password:[{required:!0,message:"Campo obrigatório",trigger:"submit"}]},workspaceForm:{selectedWorkspaceIndex:""},workspaceRules:{selectedWorkspaceIndex:[{required:!0,message:"Campo obrigatório",trigger:"submit"}]}}},computed:{passwordType(){return this.showPassword?"text":"password"}},beforeMount(){const e=Object.keys(localStorage).filter((e=>e.startsWith("jusworkspace"))).length>0;e&&!(0,a.p$)()?this.getMyWorkspaces():this.$store.getters.isLoggedIn&&this.$store.dispatch("logout"),document.querySelectorAll(".prompt-insert-name .el-message-box__headerbtn").forEach((e=>e.click()))},created(){this.$route.query.token&&this.$store.dispatch("activate",this.$route.query.token).then((()=>{this.showSuccess=!0})).finally((()=>{this.$router.push("login")}))},methods:{...(0,n.nv)({sendEmail:"sendCustomEmail",getAccountProperty:"getAccountProperty"}),getErrorMessage(){const e=["Aguarde um momento que já iremos lhe autenticar","O serviço de autenticação de usuários está sendo atualizado para aplicar melhorias e mais segurança","Atualizando o serviço de autenticação de usuário"],t=e[this.loadingIndex%3];return this.loadingIndex+=1,t},doLogin(){this.$refs.loginForm.validate((e=>{if(!e)return!1;this.showError=!1,this.showLoading=!0,this.$store.dispatch("login",this.loginForm).then((()=>{this.$store.dispatch("myAccount").then(this.getMyWorkspaces).catch((e=>{this.$jusNotification({error:e}),this.showLoading=!1}))})).catch((e=>{localStorage.removeItem("justoken"),!e.response||401!==e.response?.status&&"INVALID_CREDENTIALS"!==e.response.data.code?"User account is locked"===e?.response?.data?.reason?(this.$jusNotification({title:"Ops!",message:"Iniciamos a recuperação de conta.",type:"error"}),this.$router.push({path:"recover-account",query:{email:this.loginForm.email}})):(this.loadingText=this.getErrorMessage(),this.showLoading=!1,this.$jusNotification({error:e})):this.mountError("E-mail não cadastrado ou senha incorreta.")}))}))},getMyWorkspaces(){return new Promise(((e,t)=>{this.$store.dispatch("myWorkspace").then((t=>{if(this.$jusSegment("Usuário logado"),Object.keys(localStorage).includes("jusredirect")){const{wid:e,did:s}=JSON.parse(localStorage.getItem("jusredirect")),o=t.findIndex((({workspace:{id:t}})=>Number(t)===Number(e)));o>=0&&s?this.$nextTick().then((()=>{this.workspaceForm.selectedWorkspaceIndex=o,this.selectWorkspace()})):(localStorage.removeItem("jusredirect"),this.$confirm("Você não possui privilégios para visualizar esta página","Warning",{closeOnPressEscape:!1,closeOnClickModal:!1,confirmButtonText:"OK",showCancelButton:!1,showClose:!1,type:"warning",center:!0}))}t.length>1?(this.showLoading=!1,this.workspaces=t):0===t.length?this.$confirm("Não encontramos nenhuma Workspace ativa ativa para o seu usuário.<br>Favor entrar em contato com o seu Gerente de Contas.",{dangerouslyUseHTMLString:!0,closeOnPressEscape:!1,closeOnClickModal:!1,confirmButtonText:"OK",showCancelButton:!1,showClose:!1,center:!0}).then((()=>{this.sendEmail({subject:"Usuário sem Workspace",address:"deivid@justto.com.br",content:`Usuário com o email <b>${this.loginForm.email}</b> tentou fazer login na plataforma, mas não pertence a nenhuma Workspace ativa.`}),location.reload()})):this.getMembersAndRedirect(t[0]),e(t)})).catch((e=>{this.$jusNotification({error:e}),this.showLoading=!1,t(e)}))}))},async getMembersAndRedirect(e){if(this.$jusSegment("Seleção de Workspace",{workspace:e.workspace.name,team:e.workspace.teamName}),e.workspace&&await this.$store.commit("setWorkspace",e.workspace),await this.$nextTick(),e.profile&&this.$store.commit("setProfile",e.profile),await this.$nextTick(),e.person){this.$store.commit("setLoggedPerson",e.person);const t=void 0!==e.person.emails?.find((({address:e,archived:t})=>!t&&(0,i.uJ)(e)));await this.$nextTick(),this.showLoading=!0,this.$store.dispatch("getWorkspaceMembers").then((()=>{this.getAccountProperty("CUSTOM_HOME").then((({CUSTOM_HOME:s})=>{const o=sessionStorage.getItem("redirect");sessionStorage.removeItem("redirect");let r="/negotiation";if(Object.keys(localStorage).includes("jusredirect")){const e=JSON.parse(localStorage.getItem("jusredirect")),t=new URLSearchParams(e).toString();r=`/redirect?${t}`}else r=o?JSON.parse(o):s||("ADMINISTRATOR"!==e.profile||t?"/negotiation":"/");this.showLoading=!0,this.$router.push(r).then((e=>{})).catch((e=>{console.error("LOGIN",e)})).finally((()=>{this.showLoading=!1}))}))})).catch((e=>{console.error(e),this.mountError(),this.workspaces=[]})).finally((()=>{this.showLoading=!1}))}else this.$router.push("/")},selectWorkspace(){this.$refs.workspaceForm.validate((e=>{if(e){const e=this.workspaces[this.workspaceForm.selectedWorkspaceIndex];e.person&&e.person.id?this.getMembersAndRedirect(e):this.$store.dispatch("ensureWorkspaceAccesss",e.workspace.id).then((e=>{this.$store.commit("setToken",e),this.getMyWorkspaces().then((e=>{this.getMembersAndRedirect(e[this.workspaceForm.selectedWorkspaceIndex])}))}))}}))},switchShowPassword(){this.showPassword=!this.showPassword},mountError(e){this.errorMessage=e||"Houve uma falha de conexão com o servidor.\n      Tente novamente ou entre em contato com o administrador do sistema.",this.showError=!0,this.showLoading=!1}}},c=l,d=(s(71600),s(1001)),p=(0,d.Z)(c,o,r,!1,null,null,null),u=p.exports},83200:function(e,t,s){"use strict";s.r(t);var o=s(87537),r=s.n(o),a=s(23645),i=s.n(a),n=i()(r());n.push([e.id,".external-view{height:100%}.external-view main{background-color:#fff!important}.external-view .external-view__title{margin-bottom:40px;font-weight:700}.external-view .external-view__form{margin:auto;width:440px;padding:20px}.external-view .external-view__submit{width:100%}.external-view .external-view__info{font-size:12px;text-align:center;margin-top:20px}.external-view .external-view__show-password{vertical-align:text-bottom;margin-right:6px;cursor:pointer}.external-view .external-view__show-password+button{border-left:1px solid #dcdfe6;padding:3px 0;padding-left:6px}.external-view .el-alert{margin-bottom:10px}.external-view .el-select{width:100%}@media screen and (max-width:991px){.external-view .el-container .el-aside{width:100%!important}}","",{version:3,sources:["webpack://./src/views/external/external.scss"],names:[],mappings:"AAAA,eACE,WAAA,CAEA,oBACE,+BAAA,CAGF,qCACE,kBAAA,CACA,eAAA,CAGF,oCACE,WAAA,CACA,WAAA,CACA,YAAA,CAGF,sCACE,UAAA,CAGF,oCACE,cAAA,CACA,iBAAA,CACA,eAAA,CAGF,6CACE,0BAAA,CACA,gBAAA,CACA,cAAA,CAEA,oDACE,6BAAA,CACA,aAAA,CACA,gBAAA,CAIJ,yBACE,kBAAA,CAGF,0BACE,UAAA,CAGF,oCAEI,uCACE,oBAAA,CAAA",sourcesContent:[".external-view {\n  height: 100%;\n\n  main{\n    background-color: #fff !important;\n  }\n\n  .external-view__title {\n    margin-bottom: 40px;\n    font-weight: 700;\n  }\n\n  .external-view__form {\n    margin: auto;\n    width: 440px;\n    padding: 20px;\n  }\n\n  .external-view__submit {\n    width: 100%;\n  }\n\n  .external-view__info {\n    font-size: 12px;\n    text-align: center;\n    margin-top: 20px;\n  }\n\n  .external-view__show-password {\n    vertical-align: text-bottom;\n    margin-right: 6px;\n    cursor: pointer;\n\n    &+button {\n      border-left: 1px solid #dcdfe6;\n      padding: 3px 0px;\n      padding-left: 6px;\n    }\n  }\n\n  .el-alert {\n    margin-bottom: 10px;\n  }\n\n  .el-select {\n    width: 100%;\n  }\n\n  @media screen and (max-width: 991px) {\n    .el-container {\n      .el-aside {\n        width: 100% !important;\n      }\n    }\n  }\n}\n"],sourceRoot:""}]),t["default"]=n},71600:function(e,t,s){var o=s(83200);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var r=s(39185).Z;r("a11da6e6",o,!0,{sourceMap:!0,shadowMode:!1})}}]);
//# sourceMappingURL=externalIndex.js.map