(self["webpackChunk_projuris_justto_web"]=self["webpackChunk_projuris_justto_web"]||[]).push([[3789],{26636:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("JusViewMain",{staticClass:"new-import-view"},[t("template",{slot:"title"},[t("h1",[e._v(" Nova importação de disputas ")])]),t("template",{slot:"main"},[t("el-steps",{staticClass:"new-import-view__steps el-steps--circle",attrs:{active:e.activeStep,"finish-status":"success"}},[t("el-step"),t("el-step"),t("el-step")],1),t("div",{staticClass:"new-import-view__content"},[t("transition",{attrs:{name:"fade"}},[0===e.activeStep?t("check-lines-step",{key:"0"}):e._e(),1===e.activeStep?t("columns-step",{key:"1"}):e._e(),2===e.activeStep?t("campaign-step",{key:"2",attrs:{"mapped-campaigns":e.mappedCampaigns,"campaign-is-mapped":e.isMapped,"duplicated-action":e.duplicatedAction},on:{"update:duplicatedAction":function(t){e.duplicatedAction=t},"update:duplicated-action":function(t){e.duplicatedAction=t}}}):e._e()],1)],1),t("div",{staticClass:"new-import-view__actions"},[t("el-button",{attrs:{plain:""},on:{click:e.previousStep}},[e._v(" Voltar ")]),2===e.activeStep?t("el-button",{attrs:{disabled:e.validationInProgress,type:"primary","data-testid":"start-negotiation"},on:{click:e.finalStep}},[e._v(" Iniciar negociação ")]):t("el-button",{attrs:{disabled:e.$store.state.loading,type:"primary","data-testid":"submit"},on:{click:e.nextStep}},[e._v(" Próximo ")])],1)],1)],2)},n=[],s=(i(57658),i(90408)),o=i(40917),p={name:"NewImport",components:{CheckLinesStep:()=>i.e(3412).then(i.bind(i,13412)),ColumnsStep:()=>i.e(3409).then(i.bind(i,3409)),CampaignStep:()=>i.e(1983).then(i.bind(i,31983))},beforeRouteLeave(e,t,i){"/import/loading"===e.path?i():this.$store.getters.hasImportsFile&&"/login"!==e.path?this.$confirm("Tem certeza que deseja sair? Todos os dados serão perdidos.",{confirmButtonText:"Sair da importação",cancelButtonText:"Cancelar",title:"Atenção!",type:"warning"}).then((()=>{i()})):i()},data(){return{uploadId:void 0,activeStep:0,mappedCampaigns:[],campaignIsMapped:!1,duplicatedAction:"IGNORE"}},computed:{...(0,s.Se)(["errorFields","validationInProgress","isWorkspaceRecovery"]),isMapped(){return this.campaignIsMapped}},beforeCreate(){this.$store.commit("removeImportsMap"),this.$store.getters.hasImportsFile||this.$router.push("/import")},methods:{...(0,s.nv)(["setErrorFields"]),setMapImportColumns(){this.$store.dispatch("mapImportColumns",this.$store.state.importModule.map).then((e=>{this.$jusSegment("Importação 3/4 Mapeamento concluido",{fileName:this.$store.getters.importedFileName}),this.mappedCampaigns=e,this.campaignIsMapped=!0,this.activeStep+=1}))},nextStep(){if(1===this.activeStep){const e=this.$store.state.importModule.map.filter((({name:e,tag:t})=>"reu"===(0,o.Ue)(e)&&null===t)).length>0;e?this.$confirm(`Detectamos que não mapeou a coluna <b>${this.$tc("PARTY_RESPONDENT",this.isWorkspaceRecovery)}</b>.<br/>É um dos campos que mais evitam erros na importação. Tem certeza que deseja continuar sem mapear esta coluna?`,`${this.$tc("PARTY_RESPONDENT",this.isWorkspaceRecovery)} não ${this.isWorkspaceRecovery?"mapeada":"mapeado"}`,{confirmButtonText:"OK",cancelButtonText:"Cancelar",dangerouslyUseHTMLString:!0,showClose:!1,center:!0}).then((()=>this.setMapImportColumns())):this.setMapImportColumns()}else this.activeStep+=1},previousStep(){this.$store.dispatch("hideLoading"),this.activeStep?this.activeStep-=1:this.$router.push("/import")},finalStep(){const e=[],t=this.mappedCampaigns.length>1&&this.mappedCampaigns[1].replicate;let i=!0,a=!1;const n=[];if(this.mappedCampaigns.forEach(((e,n,s)=>{const o={...t?s[0]:e};this.setErrorFields(this.campaignErrorFields(o)),this.checkValidCampaign(o)||(i=!1),a=!0})),a&&i){for(const i of this.mappedCampaigns){const a=JSON.parse(JSON.stringify(i));e.push({name:a.name,strategy:a.strategy});const s={...t?this.mappedCampaigns[0]:a,name:a.name,respondent:a.respondent,deadline:a.deadline,cluster:a.cluster,paymentDeadLine:"P"+(t?this.mappedCampaigns[0]:a).paymentDeadLine+"D",allowDuplicateDispute:"DUPLICATE"===this.duplicatedAction,allowUpdateDispute:"UPDATE"===this.duplicatedAction};delete s.campaign,delete s.rows,delete s.createdAt,delete s.createdBy,delete s.id,delete s.updatedAt,delete s.updatedBy,delete s.replicate,n.push(this.$store.dispatch("createCampaign",s))}Promise.all(n).then((()=>{this.$jusSegment("Importação 4/4 Importação Concluída",{fileName:this.$store.getters.importedFileName}),this.$store.dispatch("startGeneseRunner").finally((()=>{this.$store.commit("removeImportsFile")})),this.$router.push("/import/loading")})).catch((e=>{this.$jusNotification({error:e})}))}else this.$jusNotification({title:"Ops!",message:"Para prosseguir você deve configurar todos os campos de todas as campanhas.",type:"warning"});const s=this.mappedCampaigns.length-1;localStorage.setItem("jusfeedbackpreferences",JSON.stringify({businessHoursEngagement:this.mappedCampaigns[s].businessHoursEngagement,contactPartyWhenNoLowyer:this.mappedCampaigns[s].contactPartyWhenNoLowyer,contactPartyWhenInvalidLowyer:this.mappedCampaigns[s].contactPartyWhenInvalidLowyer,skipEnrichment:this.mappedCampaigns[s].skipEnrichment,denySavingDeposit:this.mappedCampaigns[s].denySavingDeposit,denyPixDeposit:this.mappedCampaigns[s].denyPixDeposit}))},campaignErrorFields(e){const t=[{value:"respondent",validation:e=>!!e.respondent},{value:"name",validation:e=>!!e.name},{value:"cluster",validation:e=>!!e.cluster},{value:"deadline",validation:e=>!!e.deadline&&!0===this.$moment(e.deadline.dateTime).isValid()},{value:"negotiatorIds",validation:e=>!!e.negotiatorIds.length},{value:"strategy",validation:e=>!!e.strategy}];return t.filter((t=>{const{value:i,validation:a}=t;return!(e.hasOwnProperty(i)&&a(e))})).map((e=>e.value))},checkValidCampaign(e){return!!(e.hasOwnProperty("respondent")&&e.respondent&&e.hasOwnProperty("name")&&e.name&&e.hasOwnProperty("cluster")&&e.cluster&&e.hasOwnProperty("deadline")&&e.deadline&&e.hasOwnProperty("negotiatorIds")&&e.negotiatorIds&&e.negotiatorIds.length>0&&e.hasOwnProperty("strategy")&&e.strategy)}}},r=p,c=(i(8074),i(1001)),m=(0,c.Z)(r,a,n,!1,null,null,null),d=m.exports},23928:function(e,t,i){"use strict";i.r(t);var a=i(87537),n=i.n(a),s=i(23645),o=i.n(s),p=o()(n());p.push([e.id,".new-import-view .jus-main-view__main-card .el-card__body{display:flex;flex-direction:column;height:100%;justify-content:space-between;align-items:center;min-height:-moz-min-content;min-height:min-content}.new-import-view__actions,.new-import-view__steps{width:500px}.new-import-view__steps{margin:0}.new-import-view__content{margin-top:32px;width:80%}.new-import-view__content h4,.new-import-view__content>p{text-align:center}.new-import-view__content .enrichment-step .el-card{margin-top:40px}.new-import-view__title{margin-bottom:40px;text-align:center}.new-import-view__actions{display:flex;margin:40px 0 20px}.new-import-view__actions button{width:100%}","",{version:3,sources:["webpack://./src/views/main/import/NewImport.vue"],names:[],mappings:"AACA,0DACE,YAAA,CACA,qBAAA,CACA,WAAA,CACA,6BAAA,CACA,kBAAA,CACA,2BAAA,CAAA,sBAAA,CAEF,kDACE,WAAA,CAGF,wBACE,QAAA,CAEF,0BACE,eAAA,CACA,SAAA,CACA,yDACE,iBAAA,CAEF,oDACE,eAAA,CAGJ,wBACE,kBAAA,CACA,iBAAA,CAEF,0BACE,YAAA,CACA,kBAAA,CACA,iCACE,UAAA",sourcesContent:["\n.new-import-view .jus-main-view__main-card .el-card__body {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  justify-content: space-between;\n  align-items: center;\n  min-height: min-content;\n}\n.new-import-view__steps, .new-import-view__actions {\n  width: 500px;\n}\n\n.new-import-view__steps {\n  margin: 0;\n}\n.new-import-view__content {\n  margin-top: 32px;\n  width: 80%;\n  >p, h4 {\n    text-align: center;\n  }\n  .enrichment-step .el-card {\n    margin-top: 40px;\n  }\n}\n.new-import-view__title {\n  margin-bottom: 40px;\n  text-align: center;\n}\n.new-import-view__actions {\n  display: flex;\n  margin: 40px 0 20px;\n  button {\n    width: 100%;\n  }\n}\n"],sourceRoot:""}]),t["default"]=p},8074:function(e,t,i){var a=i(23928);a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);var n=i(39185).Z;n("67c47d06",a,!0,{sourceMap:!0,shadowMode:!1})}}]);
//# sourceMappingURL=importNew.js.map