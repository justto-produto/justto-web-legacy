(self["webpackChunk_projuris_justto_web"]=self["webpackChunk_projuris_justto_web"]||[]).push([[1160],{94448:function(o,e,i){"use strict";i.r(e),i.d(e,{default:function(){return u}});var t=function(){var o=this,e=o._self._c;return e("section",{directives:[{name:"loading",rawName:"v-loading",value:o.isLoading,expression:"isLoading"}],staticClass:"workspace-container"},[e("el-table",{staticClass:"workspace-container__table",staticStyle:{width:"100%"},attrs:{data:o.filteredWorkspaces,height:"95vh"},on:{"row-click":o.handleRowClick}},[e("el-table-column",{attrs:{prop:"name",label:"Workspace"}}),e("el-table-column",{attrs:{prop:"teamName",label:"Equipe"}}),e("el-table-column",{attrs:{prop:"keyAccountId",label:"Key Account"},scopedSlots:o._u([{key:"default",fn:function(i){return[i.row.id===o.activeRow?e("el-select",{attrs:{id:`ka-select-${i.row.id}`,value:i.row.keyAccountId,size:"small",filterable:""},on:{change:function(e){return o.saveKeyAccountInToWorkspace(e,i.row)}}},o._l(o.keyAccounts,(function(i){return e("el-option",{key:`key-account-${i.id}`,attrs:{value:i.id,label:o.keyAccountTemplate(i)}})})),1):e("span",{style:{cursor:"pointer"}},[o._v(" "+o._s(o.keyAccountTemplate(o.findKeyAccount(i.row.keyAccountId)))+" ")])]}}])}),e("el-table-column",{attrs:{align:"right",prop:"portifolios","class-name":"portifolios-column"},scopedSlots:o._u([{key:"default",fn:function(i){return[o._l(i.row.portifolios,(function(i){return e("el-tag",{key:i.id,attrs:{size:"mini"}},[o._v(" "+o._s(o.portifolioById(i.id).name)+" ")])})),0===i.row.portifolios.length?e("a",[o._v("Ver tipos de carteira")]):o._e()]}}])},[o.hideSearch?o._e():e("template",{slot:"header"},[e("div",{staticClass:"el-input el-input--mini"},[e("input",{directives:[{name:"model",rawName:"v-model",value:o.search,expression:"search"}],staticClass:"el-input__inner",attrs:{placeholder:"Pesquise aqui"},domProps:{value:o.search},on:{input:[function(e){e.target.composing||(o.search=e.target.value)},function(e){return o.$forceUpdate()}]}})])])],2)],1),e("el-dialog",{attrs:{title:"Tipos de carteira",visible:o.dialog.visible,"append-to-body":"","custom-class":"portifolios-dialog"},on:{"update:visible":function(e){return o.$set(o.dialog,"visible",e)}}},[e("el-select",{directives:[{name:"loading",rawName:"v-loading",value:o.isLoading,expression:"isLoading"}],attrs:{size:"small","default-first-option":"","allow-create":"",filterable:"",multiple:""},model:{value:o.handledDialogPortifolios,callback:function(e){o.handledDialogPortifolios=e},expression:"handledDialogPortifolios"}},o._l(o.portifolios,(function(o){return e("el-option",{key:`portifolio-${o.id}`,attrs:{value:o.id,label:o.name}})})),1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){return o.closeDialog()}}},[o._v("Cancelar")]),e("el-button",{attrs:{type:"primary",disabled:o.disableSavePortifolios},on:{click:o.salvarPortifolios}},[o._v(" Salvar ")])],1)],1)],1)},s=[],a=i(90408),r=i(51579),l=i.n(r),n={props:{filterTerm:{type:String,default:()=>""},hideSearch:{type:Boolean,default:!1}},data:()=>({isLoading:!1,modelSearch:"",dialog:{visible:!1,workspace:null,portifolios:[]},activeRow:null}),computed:{...(0,a.Se)({workspaces:"getMyWorkspaces",keyAccounts:"getWorkspaceKeyAccounts",portifolios:"getPortifolios",portifoliosByWorkspace:"getPortifoliosByWorkspace"}),search:{get(){return this.modelSearch||this.filterTerm},set(o){this.modelSearch=o}},portifolioById(){return o=>this.portifolios.find((e=>Number(e.id)===Number(o)))},filteredWorkspaces(){return this.search?this.workspaces.filter((({name:o,teamName:e,keyAccountId:i})=>{const t=this.search.toLocaleLowerCase(),s=(e||"").toLocaleLowerCase(),a=(this.keyAccountTemplate(this.findKeyAccount(i))||"").toLocaleLowerCase(),r=(o||"").toLocaleLowerCase();return s.includes(t)||r.includes(t)||a.includes(t)})).map((o=>({portifolios:[],...o}))):this.workspaces.map((o=>({portifolios:[],...o})))},handledDialogPortifolios:{get(){return this.portifoliosByWorkspace[this.dialog.workspace]||[]},set(o){const e=o.filter((o=>"string"!==typeof o||(this.createPortifolioAndInsert({name:o,workspaceId:this.dialog.workspace}).finally((()=>this.$forceUpdate())),!1)));this.insertPortifolios({portifolios:e,workspaceId:this.dialog.workspace})}},disableSavePortifolios(){return l().isEqual(this.handledDialogPortifolios,this.dialog.portifolios)}},beforeMount(){this.init()},methods:{...(0,a.nv)(["myWorkspace","getPortifolios","getPortifolioAssociated","getWorkspaceKeyAccounts","setPortifolioToWorkspace","updateWorkspaceKeyAccount","createPortifolioAndInsert","associatePortifolioToWorkspace","disassociatePortifolioToWorkspace"]),...(0,a.OI)(["insertPortifolios"]),init(){this.isLoading=!0,Promise.all([this.myWorkspace(),this.getPortifolios(),this.getWorkspaceKeyAccounts()]).then((()=>{})).finally((()=>{this.isLoading=!1}))},findKeyAccount(o){return this.keyAccounts.find((({id:e})=>Number(e)===Number(o)))},keyAccountTemplate(o){return o?(o.name?`${o.name} - `:"")+`${o.email}`:"-"},updateWorkspacePortifolios(o,e){this.$set(this.workspaces.find((({id:e})=>Number(e)===Number(o))),"portifolios",e)},openPortifolioDialog(o){this.isLoading=!0,this.getPortifolioAssociated(o).then((e=>{this.updateWorkspacePortifolios(o,e),this.dialog={portifolios:e.map((({id:o})=>Number(o))),visible:!0,workspace:o},this.handledDialogPortifolios=e.map((({id:o})=>Number(o)))})).finally((()=>{this.isLoading=!1}))},salvarPortifolios(){const o=l().difference(this.handledDialogPortifolios,this.dialog.portifolios),e=l().difference(this.dialog.portifolios,this.handledDialogPortifolios),i=this.dialog.workspace;this.isLoading=!0,Promise.all([...e.map((o=>this.disassociatePortifolioToWorkspace({portifolioId:o,workspaceId:i}))),...o.map((o=>this.associatePortifolioToWorkspace({portifolioId:o,workspaceId:i})))]).then((()=>{this.updateWorkspacePortifolios(i,this.handledDialogPortifolios.map((o=>({id:o})))),this.$jusNotification({type:"success",title:"Yay!",message:"Tipos de carteira salvos com sucesso"}),this.closeDialog()})).finally((()=>{this.isLoading=!1}))},closeDialog(){this.dialog={portifolios:[],visible:!1,workspace:null}},handleRowClick(o,e,i){switch(e.property){case"portifolios":this.openPortifolioDialog(o.id);break;case"keyAccountId":this.setActiveRow(o.id);break;default:break}},setActiveRow(o){this.activeRow=o,this.$nextTick((()=>{document.querySelector(`#ka-select-${o}`)&&document.querySelector(`#ka-select-${o}`).click()}))},saveKeyAccountInToWorkspace(o,{id:e}){this.updateWorkspaceKeyAccount({keyAccountId:o,workspaceId:e}).then((()=>{this.setActiveRow(null)}))}}},c=n,d=(i(40963),i(23427),i(1001)),p=(0,d.Z)(c,t,s,!1,null,"82438f12",null),u=p.exports},75653:function(o,e,i){"use strict";i.r(e);var t=i(87537),s=i.n(t),a=i(23645),r=i.n(a),l=r()(s());l.push([o.id,".portifolios-dialog .el-dialog__body .el-select{width:100%}.portifolios-column{padding:4px 0!important}.portifolios-column .cell .el-tag{margin:4px}","",{version:3,sources:["webpack://./src/views/main/configurations/partials/WorkspaceList.vue"],names:[],mappings:"AAGI,gDACE,UAAA,CAKN,oBACE,uBAAA,CAGE,kCACE,UAAA",sourcesContent:["\n.portifolios-dialog {\n  .el-dialog__body {\n    .el-select {\n      width: 100%;\n    }\n  }\n}\n\n.portifolios-column {\n  padding: 4px 0 !important;\n\n  .cell {\n    .el-tag {\n      margin: 4px;\n    }\n  }\n}\n"],sourceRoot:""}]),e["default"]=l},73508:function(o,e,i){"use strict";i.r(e);var t=i(87537),s=i.n(t),a=i(23645),r=i.n(a),l=r()(s());l.push([o.id,".workspace-container[data-v-82438f12]{width:100%}","",{version:3,sources:["webpack://./src/views/main/configurations/partials/WorkspaceList.vue"],names:[],mappings:"AACA,sCACE,UAAA",sourcesContent:["\n.workspace-container {\n  width: 100%;\n}\n"],sourceRoot:""}]),e["default"]=l},40963:function(o,e,i){var t=i(75653);t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[o.id,t,""]]),t.locals&&(o.exports=t.locals);var s=i(39185).Z;s("32abddbb",t,!0,{sourceMap:!0,shadowMode:!1})},23427:function(o,e,i){var t=i(73508);t.__esModule&&(t=t.default),"string"===typeof t&&(t=[[o.id,t,""]]),t.locals&&(o.exports=t.locals);var s=i(39185).Z;s("327051ef",t,!0,{sourceMap:!0,shadowMode:!1})}}]);
//# sourceMappingURL=workspaces.js.map