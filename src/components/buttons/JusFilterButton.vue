<template lang="html">
  <div
    :class="{'jus-filter-button--collapse': isCollapsed}"
    class="jus-filter-button"
    @keyup.esc="toggle()">
    <el-input
      ref="filterInput"
      v-model="term"
      @blur="blur()">
      <el-button
        slot="prepend"
        @click="toggle()">
        <jus-icon icon="search" />
      </el-button>
      <i
        v-if="!isCollapsed"
        slot="suffix"
        class="el-input__icon el-icon-close"
        @click="toggle()" />
    </el-input>
  </div>
</template>

<script>
export default {
  name: 'JusFilterButton',
  data () {
    return {
      term: '',
      isCollapsed: true,
      debounce: ''
    }
  },
  watch: {
    isCollapsed (isCollapsed) {
      if (isCollapsed) {
        this.term = ''
        this.$refs.filterInput.blur()
      } else {
        this.focus()
      }
    },
    term (term) {
      clearTimeout(this.debounce)
      this.debounce = setTimeout(() => {
        this.$store.commit('setDisputeFilterTerm', term)
      }, 800)
    }
  },
  beforeMount () {
    this.term = this.$store.getters.disputeFiltersTerm
    if (this.term) this.isCollapsed = false
  },
  methods: {
    toggle () {
      this.isCollapsed = !this.isCollapsed
    },
    blur () {
      setTimeout(() => {
        if (!this.term) {
          this.isCollapsed = true
        }
      }, 250)
    },
    focus () {
      this.$refs.filterInput.focus()
    }
  }
}
</script>

<style lang="scss">
@import '@/styles/colors.scss';

.jus-filter-button {
  position: relative;
  display: inline-block;
  white-space: nowrap;
  .el-input {
    position: absolute;
  }
  .el-input__inner {
    transition: width 0.5s ease, padding 0.5s ease;
    width: 303px;
    border-left: 0;
    &:hover {
      border-left: 1px solid $--color-text-regular;
    }
    &:focus {
      border-left: 1px solid $--color-primary;
    }
  }
  .el-input-group__prepend {
    border-right: 1px solid #dcdfe6;
    background-color: $--color-white;
    &:hover {
      border-color: $--color-primary;;
    }
  }
  &--collapse {
    .el-input__inner {
      width: 0px;
      padding: 0px;
      border: 0;
    }
    .el-input-group__prepend {
      pointer-events: all;
    }
  }
  .el-input__icon {
    cursor: pointer;
  }
}
</style>
